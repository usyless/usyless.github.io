var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function ba(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ca=ba(this);
function da(a,b){if(b)a:{var c=ca;a=a.split(".");for(var d=0;d<a.length-1;d++){var f=a[d];if(!(f in c))break a;c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
da("String.prototype.replaceAll",function(a){return a?a:function(b,c){if(b instanceof RegExp&&!b.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument.");return b instanceof RegExp?this.replace(b,c):this.replace(new RegExp(String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),c)}});var e=!0;const g=[],ea=[];
async function q(a,{A:b=[],buttons:c,o:d=[],onclose:f,v:h}={}){r();e=!1;return new Promise(l=>{const p=document.createElement("div"),m=document.createElement("div"),k=document.createElement("div");p.setAttribute("usy-overlay","");p.classList.add("fullscreen","blur");m.classList.add("popupOuter",...d);k.classList.add("popupInner",...d);const y=[];if("string"===typeof a){var n=document.createElement("div");n.classList.add("popupText");n.textContent=a;y.push(n)}else Array.isArray(a)?y.push(...a):y.push(a);
m.appendChild(k);if("string"===typeof c||null==c){n=document.createElement("div");n.classList.add("popupButtons");const t=document.createElement("button");t.classList.add("standardButton");t.textContent=c??"Ok";n.appendChild(t);t.addEventListener("click",()=>{const C=a.C?.();r();l(C??!0)})}else n=c;k.append(...y,n);p.addEventListener("click",t=>{t.target===t.currentTarget&&(r(),l(!1))});p.appendChild(m);b.push({target:window,type:"keydown",listener:t=>{"escape"===t.key.toLowerCase()&&p.click()}});
for(const t of b)g.push(t),t.target.addEventListener(t.type,t.listener);null!=f&&ea.push(f);h?.(p);document.body.appendChild(p)})}function r(){e=!0;for(const a of g)a.target?.removeEventListener?.(a.type,a.listener);for(const a of ea)a();ea.length=0;g.length=0;document.querySelectorAll("[usy-overlay]").forEach(a=>a.remove())};const u={FRHigher:2E4,FRLower:20,colourTolerance:67,PPO:48,delimitation:"tab",lowFRExport:20,highFRExport:2E4,SPLHigher:"",SPLLower:""};document.getElementById("restoreDefault").addEventListener("click",()=>{fa();q("Restored settings to default")});function fa(){for(const a in u)document.getElementById(a).value=u[a]}let v,w,x,ha,z=null,A=null;const B=document.getElementById("glass");B.j=B.querySelector("img");B.F=a=>{B.style.borderColor=`rgb(${a})`};
B.u=()=>{D.l()&&(B.j.src=D.src,B.j.width=3*D.clientWidth,B.j.height=3*D.clientHeight)};
var ia=()=>{document.querySelector('.waiting-overlay[data-for="trace"]').classList.remove("enabled")},E=document.getElementById("lines"),F={xHigh:document.getElementById("xHigh"),xLow:document.getElementById("xLow"),yHigh:document.getElementById("yHigh"),yLow:document.getElementById("yLow")},ja=(a,b)=>{const c=a.dataset.direction;a.nextElementSibling.setAttribute(c,b);a.setAttribute(`${c}1`,b);a.setAttribute(`${c}2`,b)},ka=()=>{for(const a of E.querySelectorAll("line"))a.setAttribute("stroke-width",
v);for(const a of E.querySelectorAll("text"))a.setAttribute("font-size",`${1.3*v}em`)},G=a=>parseFloat(a.getAttribute(`${a.dataset.direction}1`)),H=(a,b)=>{const c=G(F[a.dataset.other]),d="x"===a.dataset.direction?w:x;a===F.xHigh||a===F.yLow?ja(a,Math.max(c+1,Math.min(d-1,b))):ja(a,Math.max(1,Math.min(c-1,b)))},I=()=>E.classList.remove("hidden"),J=()=>E.classList.add("hidden"),ma=()=>{for(const a of K){const [b,c]="x"===a.dataset.direction?["y",x]:["x",w];a.setAttribute(`${b}1`,"0");a.setAttribute(`${b}2`,
c)}F.xHigh.nextElementSibling.setAttribute("y",(x/2).toString());F.xLow.nextElementSibling.setAttribute("y",(x/2).toString());F.yHigh.nextElementSibling.setAttribute("x",(w/2).toString());F.yLow.nextElementSibling.setAttribute("x",(w/2).toString())},K=[F.xHigh,F.xLow,F.yHigh,F.yLow],oa=()=>{na.classList.remove("hidden");L.setAttributeNS(null,"width","0")},pa=()=>{document.getElementById("erasing").classList.add("hidden")},na,L,M;na=document.getElementById("erasing");L=na.firstElementChild;
const D=document.getElementById("uploadedImage");D.g=a=>{const b=D.getBoundingClientRect(),c=a.clientX;a=a.clientY;return{x:c,y:a,xRel:c-b.left,yRel:a-b.top}};D.l=()=>D.src.startsWith("blob:");D.D=()=>{const a=N.get(D.src),b={};if(a){for(const c in F)b[c]=G(F[c]);a.lines=b}};D.B=()=>{const a=N.get(D.src).lines;for(const b in F)H(F[b],a[b]);ma();I()};const qa=a=>{q(a).then(()=>qa(a)).catch(()=>qa(a))};
var ra=()=>{for(const a of document.querySelectorAll("#sidebar [data-default]"))a.textContent=a.dataset["default"];z=null;A?.()},sa=a=>{document.getElementById("undo").disabled=!a.undo;document.getElementById("redo").disabled=!a.redo};
const ta=["selectPath","selectPoint","eraseRegion"],ua={path:J,point:J,erase:()=>{J();oa()}},va={path:I,point:I,erase:()=>{pa();I()}},wa=a=>{a=a.target;const b=a.dataset.mode,c=JSON.parse(JSON.stringify(z));ra();c===b?(A?.(),z=null):(a.textContent=a.dataset.active,A?.(),A=va[b],z=b,ua[b]())};for(const a of ta)document.getElementById(a).addEventListener("click",wa);
var ya=(()=>{const a=new Worker("./a.out.js");a.onmessage=b=>{b=b.data;var c=b.type;switch(c){case "exportTrace":const d=document.createElement("a"),f=URL.createObjectURL(new Blob([b["export"]],{type:"text/plain;charset=utf-8"}));d.href=f;b=document.createElement("div");c=document.createElement("div");const h=document.createElement("input");c.textContent="Export file name";h.placeholder="trace";h.type="text";h.classList.add("sidebarSection");b.append(c,h);b.classList.add("exportBox");b.C=()=>h.value;
q(b,{buttons:"Save Trace"}).then(l=>{!1!==l&&(d.download=l||"trace.txt",d.click());URL.revokeObjectURL(f)});setTimeout(()=>{h.focus()},50);break;case "error":ia();qa(b.message);break;case "getHistoryStatus":sa(b);break;case "setData":console.timeEnd("Initialise image");break;default:D.src===b.src&&("getPixelColour"===c?B.F(b.pixelColour):"snapLine"===c?(H(F[b.line.name],b.line.position),b["final"]&&(G(F.xHigh)<.2*w&&H(F.xHigh,w),G(F.xLow)>.8*w&&H(F.xLow,0),G(F.yHigh)>.8*x&&H(F.yHigh,0),G(F.yLow)<
.2*x&&H(F.yLow,x))):(xa(b.svg),ia(),O({type:"getHistoryStatus"})))}};return a})(),O=a=>D.l()&&ya.postMessage({src:D.src,...a}),za=(a,b)=>{O({type:"eraseRegion",begin:a,end:b})},Aa=()=>{O({type:"autoTrace",colourTolerance:document.getElementById("colourTolerance").value||u.colourTolerance})},P=(a,b,c=!1)=>{O({type:"snapLine",line:{name:a.id,position:G(a),direction:a.dataset.direction},direction:b,final:c})},xa=a=>{var b=document.getElementById("trace");const c=b.lastElementChild;b=b.firstElementChild;
c.setAttribute("d",a);c.setAttribute("stroke","#ff0000");c.setAttribute("stroke-width",ha);b.setAttribute("d",a);b.setAttribute("stroke-width",(1.5*ha).toString())};document.getElementById("autoPath").addEventListener("click",Aa);document.getElementById("undo").addEventListener("click",()=>O({type:"undoTrace"}));document.getElementById("redo").addEventListener("click",()=>O({type:"redoTrace"}));document.getElementById("clearPath").addEventListener("click",()=>O({type:"clearTrace"}));
document.getElementById("export").addEventListener("click",()=>{const a=c=>Object.values(c).some(d=>d&&"object"===typeof d?a(d):null==d||""===d),b={type:"exportTrace",PPO:document.getElementById("PPO").value||u.G,delim:document.getElementById("delimitation").value||u.delimitation,lowFR:document.getElementById("lowFRExport").value||u.lowFRExport,highFR:document.getElementById("highFRExport").value||u.highFRExport,SPL:{top:document.getElementById("SPLHigher").value,topPixel:G(F.yHigh),bottom:document.getElementById("SPLLower").value,
bottomPixel:G(F.yLow)},FR:{top:document.getElementById("FRHigher").value,topPixel:G(F.xHigh),bottom:document.getElementById("FRLower").value,bottomPixel:G(F.xLow)}};a(b)?q("Please fill in all required values to export (SPL and FR values)"):O(b)});document.getElementById("smoothTrace").addEventListener("click",()=>O({type:"smoothTrace"}));const N=new Map,Q=document.getElementById("fileInput");
var Ba=document.getElementById("imageQueueInner"),Ca=a=>{N.delete(a.src);O({type:"removeImage",src:a.src});URL.revokeObjectURL(a.src);a.remove()},Da=()=>{Ba.querySelector('img[class="selectedImage"]').scrollIntoView({inline:"center",behavior:"smooth"})},Fa=(a,b=!1)=>{const c=document.createElement("img"),d=document.getElementById("imageQueueInner");c.src=a;N.set(c.src,{initial:!0});c.addEventListener("dragstart",f=>f.preventDefault());c.addEventListener("click",f=>{f.preventDefault();f.stopPropagation();
D.D();D.src=a;for(const h of Ba.querySelectorAll('img[class="selectedImage"]'))h.classList.remove("selectedImage");c.classList.add("selectedImage");Da()});c.addEventListener("contextmenu",f=>{f.preventDefault();c.classList.contains("selectedImage")&&(f=c.nextElementSibling,f||(f=c.previousElementSibling),f?f.click():Ea());Ca(c)});d.appendChild(c);b&&(c.click(),setTimeout(()=>Da(),50))};document.getElementById("removeImage").addEventListener("click",()=>document.querySelector('img[class="selectedImage"]')?.dispatchEvent(new Event("contextmenu")));
document.getElementById("toggleImageQueue").addEventListener("click",a=>{a=a.target;document.getElementById("imageContainer").addEventListener("transitionend",()=>window.dispatchEvent(new Event("resize")),{once:!0});a.textContent===a.dataset.active?(a.textContent=a.dataset["default"],a.removeAttribute("active")):(a.textContent=a.dataset.active,a.setAttribute("active",""))});
document.getElementById("editImage").addEventListener("click",()=>{if(D.l()){const d=document.createElement("div");var a=document.createElement("h3"),b=document.createElement("div"),c=document.createElement("button");const f=document.createElement("div"),h=document.createElement("img");d.id="editContainer";d.append(a,b,f);f.append(h);f.classList.add("cropWrapper");h.draggable=!1;a.textContent="Edit Image";b.appendChild(c);c.textContent="Invert";c.classList.add("standardButton");h.src=D.src;c.addEventListener("click",
()=>h.classList.toggle("inverted"));a=document.createElement("div");a.classList.add("popupButtons");b=document.createElement("button");c=document.createElement("button");b.classList.add("standardButton");b.textContent="Cancel";c.classList.add("standardButton");c.textContent="Save";a.append(b,c);b.addEventListener("click",r);c.addEventListener("click",()=>{const l=document.createElement("canvas"),p=l.getContext("2d");l.width=w;l.height=x;p.drawImage(h,0,0);if(h.classList.contains("inverted")){const m=
p.getImageData(0,0,w,x),k=m.data,y=k.length;for(let n=0;n<y;n+=4)k[n]=255-k[n],k[n+1]=255-k[n+1],k[n+2]=255-k[n+2];p.putImageData(m,0,0)}document.getElementById("removeImage").click();l.toBlob(m=>{Fa(URL.createObjectURL(m),!0);r()})},{once:!0});q(d,{buttons:a})}else q("No valid image selected")});fa();Ea();Q.m=a=>{a=Array.from(a).filter(c=>c.type.startsWith("image/"));const b=a.length-1;0<a.length?(r(),a.forEach((c,d)=>{c=URL.createObjectURL(c);Fa(c,d===b)})):q("Invalid image/file(s) added!")};
Q.addEventListener("change",a=>{Q.m(a.target.files)});D.addEventListener("dragstart",a=>a.preventDefault());document.getElementById("fileInputButton").addEventListener("click",()=>Q.click());document.addEventListener("paste",a=>{a.preventDefault();const b=new DataTransfer;for(const c of a.clipboardData.items)"file"===c.kind&&b.items.add(c.getAsFile());0<b.files.length&&Q.m(b.files)});R("dragover",document.body,a=>{a.preventDefault();a.dataTransfer.dropEffect="copy";document.body.classList.add("lowOpacity")});
R(["dragleave","dragend"],document.body,a=>{a.preventDefault();document.body.classList.remove("lowOpacity")});R("drop",document.body,a=>{a.preventDefault();document.body.classList.remove("lowOpacity");Q.m(a.dataTransfer.files)});
D.addEventListener("pointermove",a=>{if("erase"!==z){a.preventDefault();const b=D.parentElement,c=b.getBoundingClientRect();a=D.g(a);B.style.left=`${Math.min(a.x-c.left,b.clientWidth-B.clientWidth)}px`;B.style.top=`${Math.min(a.y-c.top,b.clientHeight-B.clientHeight)}px`;B.j.style.left=`${-1*(3*a.xRel-B.clientWidth/2)}px`;B.j.style.top=`${-1*(3*a.yRel-B.clientHeight/2)}px`;O({type:"getPixelColour",x:a.xRel*v,y:a.yRel*v});B.classList.remove("hidden")}});
R(["pointerleave","pointerout","pointercancel"],D,()=>B.classList.add("hidden"));let S=null,Ga=D.g;E.addEventListener("pointerdown",a=>{const b=Ga(a);a={x:.02*w,y:.02*x};for(var c of K)c.offset=b[`${c.dataset.direction}Rel`]*v-G(c);c=K.reduce((d,f)=>Math.abs(f.offset)<Math.abs(d.offset)?f:d,K[0]);Math.abs(c.offset)<a[c.dataset.direction]&&(S=c)});E.addEventListener("pointermove",a=>{S&&H(S,Ga(a)[`${S.dataset.direction}Rel`]*v-S.offset)});
R(["pointerup","pointerleave","pointercancel"],E,a=>{a.preventDefault();S=null});let T,Ha,Ia=document.getElementById("snapToLines").checked;document.getElementById("snapToLines").addEventListener("change",()=>Ia=document.getElementById("snapToLines").checked);
document.getElementById("buttonSection").addEventListener("pointerdown",a=>{const b=a.target,c=b.parentNode;!T&&c.classList.contains("moveButtons")&&(a.preventDefault(),Ha=F[c.dataset["for"]],Ia?P(F[c.dataset["for"]],parseInt(b.dataset.direction,10)):T=setInterval(()=>{H(Ha,G(Ha)+parseInt(b.dataset.direction,10)*v)},10))});R(["pointerup","pointerleave","pointerout","pointercancel"],document.getElementById("buttonSection"),a=>{a.preventDefault();clearInterval(T);T=null});
window.addEventListener("resize",()=>{v=w/D.clientWidth;ka();B.u()});const Ja={path:(a,b)=>{O({type:"trace",x:a,y:b,colourTolerance:document.getElementById("colourTolerance").value||u.colourTolerance})},point:(a,b)=>O({type:"addPoint",x:a,y:b})};D.addEventListener("pointerup",a=>{null!=z&&(a=D.g(a),Ja[z]?.(a.xRel*v,a.yRel*v))});let U=!1;
D.addEventListener("pointerdown",a=>{"erase"===z&&(a.preventDefault(),U=!0,a=D.g(a).xRel*v,oa(),M=Math.max(Math.min(+a,w),0),L.setAttributeNS(null,"x",a),document.addEventListener("pointerup",Ka,{once:!0}))});D.addEventListener("pointermove",a=>{U&&"erase"===z&&(a.preventDefault(),a=D.g(a).xRel*v,a=+a,a<M?(L.setAttributeNS(null,"width",`${M-a}px`),L.setAttributeNS(null,"x",a)):(L.setAttributeNS(null,"width",`${a-M}px`),L.setAttributeNS(null,"x",M.toString())))});
const Ka=a=>{U&&"erase"===z&&(a.preventDefault(),U=!1,a=D.g(a).xRel*v,a=Math.max(Math.min(+a,w),0),za(...(M<a?[M,a]:[a,M])),L.setAttributeNS(null,"width","0"))};
D.addEventListener("load",()=>{document.getElementById("defaultMainText").classList.add("hidden");for(var a of document.querySelectorAll("[data-disabled]"))a.disabled=!1;ra();w=D.naturalWidth;x=D.naturalHeight;ha=.003*Math.max(w,x);v=w/D.clientWidth;pa();for(var b of document.querySelectorAll("svg"))b.setAttribute("width",w),b.setAttribute("height",x),b.setAttribute("viewBox",`0 0 ${w} ${x}`);xa("");B.u();a=N.get(D.src);if(a.initial){document.querySelector('.waiting-overlay[data-for="trace"]').classList.add("enabled");
console.time("Initialise image");b=w;var c=x,d=document.createElement("canvas");const f=d.getContext("2d");d.width=b;d.height=c;f.drawImage(D,0,0);d=f.getImageData(0,0,b,c);ya.postMessage({src:D.src,type:"setData",data:d.data,width:b,height:c},[d.data.buffer]);H(F.xHigh,w);H(F.xLow,0);H(F.yHigh,0);H(F.yLow,x);ma();I();P(F.xHigh,-1);P(F.xLow,1);P(F.yHigh,1);P(F.yLow,-1,!0);Aa();a.initial=!1}else O({type:"setCurrent"}),D.B(),O({type:"getCurrentPath"});ka()});
D.addEventListener("error",()=>{if(D.l()){for(const a of Ba.querySelectorAll('img[class="selectedImage"]'))Ca(a);q("Error loading this image, it may be malformed")}});
const V=new PointerEvent("pointerdown",{bubbles:!0}),W=new PointerEvent("pointerup",{bubbles:!0}),La={z:a=>a.ctrlKey&&document.getElementById(a.shiftKey?"redo":"undo").click(),a:()=>document.getElementById("autoPath").click(),t:()=>document.getElementById("selectPath").click(),p:()=>document.getElementById("selectPoint").click(),h:()=>document.getElementById("toggleImageQueue").click(),s:a=>document.getElementById(a.ctrlKey?"export":"smoothTrace").click(),e:a=>document.getElementById(a.ctrlKey?"editImage":
"eraseRegion").click(),enter:()=>document.getElementById("fileInputButton").click(),delete:()=>document.getElementById("removeImage").click(),backspace:()=>document.getElementById("clearPath").click(),arrowup:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(V),arrowdown:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(V),arrowleft:a=>document.querySelector(`[data-for="x${a.shiftKey?
"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(V),arrowright:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(V)},Ma={arrowup:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(W),arrowdown:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(W),arrowleft:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(W),
arrowright:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(W)};document.addEventListener("keydown",a=>{if(e){const b=La[a.key.toLowerCase()];!a.target.closest("input")&&b&&(a.preventDefault(),b(a))}});document.addEventListener("keyup",a=>{if(e){const b=Ma[a.key.toLowerCase()];!a.target.closest("input")&&b&&(a.preventDefault(),b(a))}});function R(a,b,c){for(const d of Array.isArray(a)?a:[a])b.addEventListener(d,c)}
function Ea(){document.getElementById("defaultMainText").classList.remove("hidden");for(const a of document.querySelectorAll("[data-disabled]"))a.disabled=!0;ra();J();pa();xa("");D.src=""}const Na=a=>{a=a.target;a.value<a.min&&(a.value=a.min)};for(const a of["FRLower","colourTolerance","lowFRExport"])document.getElementById(a).addEventListener("change",Na);const X=[{i:"Welcome to UsyTrace",body:"<h2>Here you can trace frequency responses from images</h2>\n\nAll you need to know, as well as keybindings are on the next few pages"},{i:"Tracing",body:"<h3>Auto Trace (a)</h3>\nTries to automatically select a line in the image, may fail, applied automatically upon image import\n    \n<h3>Select Path (t)</h3>\nTraces to the right of the point you click on the image, can complete a trace by starting from the left side of the frequency response and clicking to the right if it misses a part\n\n<h3>Add Point (p)</h3>\nAdd a single point to the trace manually, useful for situations where Select Path or Auto Trace Fails\n\n<h3>Smooth Trace (s)</h3>\nSmooths out sudden bumps in the traced line, good for if the original image is bad and the traced line is inconsistent\n\n<h3>Undo (Ctrl + z)</h3>\nGoes back to the previous trace step, saves add point, tracing, and clearing history\n\n<h3>Redo (Ctrl + Shift + z)</h3>\nGoes back to recently undone trace steps\n\n<h3>Erase Region (e)</h3>\nSelect a region to erase a trace from by dragging a box around the area\n\n<h3>Clear Path (Backspace)</h3>\nClears the current trace on screen, can go back using Undo"},
{i:"Exporting",body:"Align <b>High</b> and <b>Low</b> lines with given values in their respective axis, then input the respective values into <b>Higher SPL</b>, <b>Lower SPL</b>, <b>Higher Frequency</b> and <b>Lower Frequency</b>.\n\nThe lines can be moved with the arrow keys, defaulting to the <b>High</b> line for each axis, but can control the <b>Low</b> line by holding <b>Shift</b>\n\n<h3>Trace Settings</h3>     \nAdjust the <b>Minimum Exported Frequency</b>, <b>Maximum Exported Frequency</b>, <b>Points Per Octave of the exported data</b>, and <b>the delimitation of the exported data</b>\n\nThen <b>Export Trace</b> will give you the result"},
{i:"Settings",body:"<h3>Buttons Snap To Axis</h3>\nwhether the buttons underneath the Export values will attempt to snap the lines to their axis, or to enable smooth manual movement\n    \n<h3>Colour Tolerance</h3>\nRaise if line is not being detected, Lower if line is jagged or detecting multiple lines"},{i:"Miscellaneous",body:"You can <b>drop</b>, or <b>choose any amount of images</b> you like into the site, other than with pasting, as that only supports one image at a time.\n\n<h3>Image Editing (Ctrl + e)</h3>\nHere you can apply filters to the image that may make it trace better.\n\n<h3>Image Queue</h3>\nLoaded images show in the image queue on the bottom, and can be removed by right-clicking them (long hold on mobile), pressing <b>Remove</b> or pressing the <b>Delete</b> key on your keyboard"}];
let Z=0;var Oa;try{Oa=parseInt(window.localStorage.getItem("USER_TUTORIAL_VERSION")??0,10)}catch{Oa=0}3!==Oa&&Pa();
function Pa(){function a(){Z>=X.length-1?m.textContent="End Tutorial":0>=Z?(m.textContent="Begin Tutorial",k.disabled=!0,k.textContent=""):(m.textContent="Next",k.disabled=!1,k.textContent="Previous");b()}function b(){const y=X[Z]??X[0];h.textContent=y.i;p.innerHTML=y.body}Z=0;const c=document.createElement("div"),d=document.createElement("div");d.classList.add("popupButtons");c.classList.add("popupText");const f=document.createElement("div"),h=document.createElement("h1"),l=document.createElement("button");
f.classList.add("headContainer");l.classList.add("standardButton");l.textContent="\ud800\udf22";l.addEventListener("click",r);f.append(h,l);const p=document.createElement("p");c.append(p);const m=document.createElement("button"),k=document.createElement("button");m.classList.add("standardButton");k.classList.add("standardButton");m.addEventListener("click",()=>{Z>=X.length-1&&l.click();++Z;a()});k.addEventListener("click",()=>{--Z;a()});a();b();d.append(k,m);q([f,c,d],{buttons:d,o:["fixedSize"],onclose:Qa})}
function Qa(){window.localStorage.setItem("USER_TUTORIAL_VERSION",(3).toString())}document.getElementById("tutorial").addEventListener("click",Pa);document.getElementById("about").addEventListener("click",()=>{const a=document.createElement("div");a.classList.add("popupInner","about");const b=document.createElement("div");let c=null;const d=document.createElement("div");d.classList.add("logo");b.appendChild(d);b.classList.add("logoWrapper");var f=document.createElement("div"),h=document.createElement("div"),l=document.createElement("div");f.classList.add("wall");h.classList.add("wall");l.classList.add("wall");var p=document.createElement("div");
for(var m=0;16>m;++m){var k=document.createElement("div");k.style.setProperty("--i",m.toString());p.appendChild(k)}p.classList.add("line");d.append(f,h,l,p);let y,n;b.addEventListener("pointermove",Y=>{Y.target===Y.currentTarget&&(clearTimeout(y),c=c??b.getBoundingClientRect(),d.style.setProperty("--dy",`${(Y.clientX-c.left-c.width/2)/5}deg`),d.style.setProperty("--dx",`${(c.height/2-(Y.clientY-c.top))/5}deg`),null==n&&(d.classList.add("quick"),n=setTimeout(()=>{d.classList.add("no-transition");d.classList.remove("quick")},
200)))});b.addEventListener("pointerleave",()=>{clearTimeout(n);n=null;y=setTimeout(()=>{d.classList.remove("quick");d.classList.remove("no-transition");d.style.removeProperty("--dx");d.style.removeProperty("--dy")},100)});f=document.createElement("div");f.classList.add("popupInner");h=document.createElement("h2");h.textContent="UsyTrace";l=document.createElement("h3");l.textContent="made with \u2764\ufe0f by usy";p=document.createElement("h6");p.textContent="i made the 3d icon while procrastinating studying for exams, try hovering over it or dragging it";
m=document.createElement("div");m.textContent="Find me at:";k=document.createElement("div");k.textContent="Discord: @usy_";const t=document.createElement("div");var C=document.createElement("a");t.textContent="Email: ";C.href="mailto:usy@usyless.uk";C.textContent="usy@usyless.uk";t.appendChild(C);C=document.createElement("div");const la=document.createElement("a");C.textContent="GitHub: ";la.href="https://github.com/usyless/UsyTrace/issues";la.textContent="usyless";C.appendChild(la);f.append(h,l,
m,k,t,C,p);a.append(b,f);q(a,{A:[{target:window,type:"resize",listener:()=>{c=b.getBoundingClientRect()}}]})});"serviceWorker"in navigator&&!["localhost","127.0.0.1"].includes(location.hostname)&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}),navigator.serviceWorker.register("./service-worker.js").then(a=>{a.addEventListener("updatefound",()=>{const b=a.installing;b.addEventListener("statechange",()=>{if("installed"===b.state&&navigator.serviceWorker.controller){const c=document.getElementById("updateAvailable");c.addEventListener("click",()=>{b.postMessage({action:"skipWaiting"})});
c.classList.remove("hidden")}})})}));const Ra={default:"\u27a1\ufe0f\ud83d\udcbb Follow system",dark:"\ud83c\udf11 Default dark",light:"\u2600\ufe0f Default light","solarized-dark":"\ud83d\udfe6 Solarized dark","solarized-light":"\ud83c\udf68 Solarized light"},Sa=()=>{for(const a of document.documentElement.classList)if(a.startsWith("theme-"))return a.replaceAll("theme-","")};let Ta;
const Ua=a=>{for(const b of Array.from(document.documentElement.classList))b.startsWith("theme-")&&document.documentElement.classList.remove(b);clearTimeout(Ta);document.documentElement.classList.add("transition-theme");Ta=setTimeout(()=>{document.documentElement.classList.remove("transition-theme")},200);"default"===a?window.localStorage.removeItem("theme"):window.localStorage.setItem("theme",a);window.dispatchEvent(new CustomEvent("themeChange"))},Va=document.getElementById("themeSwitch");
Va.addEventListener("click",()=>{const a=document.createElement("div");var b=document.createElement("h3");a.classList.add("themePopupInner");b.textContent="Theme";a.appendChild(b);for(var c in Ra)b=document.createElement("button"),b.classList.add("standardButton"),b.textContent=Ra[c],b.dataset.theme=c,a.appendChild(b);if(c=a.querySelector(`[data-theme="${Sa()}"]`))c.classList.add("active"),c.textContent+=" - current";a.addEventListener("click",d=>{if(d=d.target.closest("[data-theme]")?.dataset?.theme)Ua(d),
r()});q(a,{buttons:"Exit",o:["themePopup"],v:d=>{d.classList.remove("blur");const {bottom:f,right:h}=Va.getBoundingClientRect();d.firstElementChild.style.bottom=window.innerHeight-f+"px";d.firstElementChild.style.right=window.innerWidth-h+"px"}})});
