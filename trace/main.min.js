const e=[],g=[];
async function h(a,{v:b=[],buttons:c,u:d=[],onclose:f}={}){p();return new Promise(u=>{const l=document.createElement("div"),v=document.createElement("div"),m=document.createElement("div");l.setAttribute("usy-overlay","");l.classList.add("fullscreen","blur");v.classList.add("popupOuter",...d);m.classList.add("popupInner",...d);const k=[];if("string"===typeof a){var r=document.createElement("div");r.classList.add("popupText");r.textContent=a;k.push(r)}else Array.isArray(a)?k.push(...a):k.push(a);v.appendChild(m);
if(null!=c)r=c;else{r=document.createElement("div");r.classList.add("popupButtons");const n=document.createElement("button");n.classList.add("standardButton");n.textContent="Ok";r.appendChild(n);n.addEventListener("click",()=>{p();u(!0)})}m.append(...k,r);l.addEventListener("click",n=>{n.target===n.currentTarget&&(p(),u(!1))});l.appendChild(v);for(const n of b)e.push(n),n.target.addEventListener(n.type,n.listener);null!=f&&g.push(f);document.body.appendChild(l)})}
function p(){for(const a of e)a.target?.removeEventListener?.(a.type,a.listener);for(const a of g)a();g.length=0;e.length=0;document.querySelectorAll("[usy-overlay]").forEach(a=>a.remove())};const q={FRHigher:2E4,FRLower:20,colourTolerance:67,PPO:48,delimitation:"tab",lowFRExport:20,highFRExport:2E4,SPLHigher:"",SPLLower:""};document.getElementById("restoreDefault").addEventListener("click",()=>{aa();h("Restored settings to default")});function aa(){for(const a in q)document.getElementById(a).value=q[a]}let t,w,x,y,z=null,A=null;const B=document.getElementById("glass");B.j=B.querySelector("img");B.C=a=>{B.style.borderColor=`rgb(${a})`};
B.o=()=>{C.m()&&(B.j.src=C.src,B.j.width=3*C.clientWidth,B.j.height=3*C.clientHeight)};
var ba=()=>{document.querySelector('.waiting-overlay[data-for="trace"]').classList.remove("enabled")},D=document.getElementById("lines"),E={xHigh:document.getElementById("xHigh"),xLow:document.getElementById("xLow"),yHigh:document.getElementById("yHigh"),yLow:document.getElementById("yLow")},ca=(a,b)=>{const c=a.dataset.direction;a.nextElementSibling.setAttribute(c,b);a.setAttribute(`${c}1`,b);a.setAttribute(`${c}2`,b)},da=()=>{for(const a of D.querySelectorAll("line"))a.setAttribute("stroke-width",
t);for(const a of D.querySelectorAll("text"))a.setAttribute("font-size",`${1.3*t}em`)},G=a=>parseFloat(a.getAttribute(`${a.dataset.direction}1`)),H=(a,b)=>{const c=G(E[a.dataset.other]),d="x"===a.dataset.direction?w:x;a===E.xHigh||a===E.yLow?ca(a,Math.max(c+1,Math.min(d-1,b))):ca(a,Math.max(1,Math.min(c-1,b)))},I=()=>D.classList.remove("hidden"),J=()=>D.classList.add("hidden"),ea=()=>{for(const a in E){const b=E[a],[c,d]="x"===b.dataset.direction?["y",x]:["x",w];b.setAttribute(`${c}1`,0);b.setAttribute(`${c}2`,
d)}E.xHigh.nextElementSibling.setAttribute("y",(x/2).toString());E.xLow.nextElementSibling.setAttribute("y",(x/2).toString());E.yHigh.nextElementSibling.setAttribute("x",(w/2).toString());E.yLow.nextElementSibling.setAttribute("x",(w/2).toString())},K=[E.xHigh,E.xLow,E.yHigh,E.yLow],ha=()=>{fa.classList.remove("hidden");M.setAttributeNS(null,"width","0")},ka=()=>{document.getElementById("erasing").classList.add("hidden")},fa,M,N;fa=document.getElementById("erasing");M=fa.firstElementChild;
const C=document.getElementById("uploadedImage");C.g=a=>{const b=C.getBoundingClientRect(),c=a.clientX;a=a.clientY;return{x:c,y:a,xRel:c-b.left,yRel:a-b.top}};C.m=()=>C.src.startsWith("blob:");C.B=()=>{const a=O.get(C.src),b={};if(a){for(const c in E)b[c]=G(E[c]);a.lines=b}};C.A=()=>{const a=O.get(C.src).lines;for(const b in E)H(E[b],a[b]);ea();I()};const la=a=>{h(a).then(()=>la(a)).catch(()=>la(a))};
var ma=()=>{for(const a of document.querySelectorAll("#sidebar [data-default]"))a.textContent=a.dataset["default"];z=null;A?.()},na=a=>{document.getElementById("undo").disabled=!a.undo;document.getElementById("redo").disabled=!a.redo};
const oa=["selectPath","selectPoint","eraseRegion"],pa={path:J,point:J,erase:()=>{J();ha()}},qa={path:I,point:I,erase:()=>{ka();I()}},ra=a=>{a=a.target;const b=a.dataset.mode,c=JSON.parse(JSON.stringify(z));ma();c===b?(A?.(),z=null):(a.textContent=a.dataset.active,A?.(),A=qa[b],z=b,pa[b]())};for(const a of oa)document.getElementById(a).addEventListener("click",ra);
var ta=(()=>{const a=new Worker("./a.out.js");a.onmessage=b=>{b=b.data;const c=b.type;switch(c){case "exportTrace":const d=document.createElement("a"),f=URL.createObjectURL(new Blob([b["export"]],{type:"text/plain;charset=utf-8"}));d.href=f;d.download="trace.txt";document.body.appendChild(d);d.click();setTimeout(()=>{document.body.removeChild(d);window.URL.revokeObjectURL(f)},0);break;case "error":ba();la(b.message);break;case "getHistoryStatus":na(b);break;case "setData":console.timeEnd("Initialise image");
break;default:C.src===b.src&&("getPixelColour"===c?B.C(b.pixelColour):"snapLine"===c?H(E[b.line.name],b.line.position):(sa(b.svg),ba(),P({type:"getHistoryStatus"})))}};return a})(),P=a=>C.m()&&ta.postMessage({src:C.src,...a}),ua=(a,b)=>{P({type:"eraseRegion",begin:a,end:b})},va=()=>{P({type:"autoTrace",colourTolerance:document.getElementById("colourTolerance").value||q.colourTolerance})},Q=(a,b)=>{P({type:"snapLine",line:{name:a.id,position:G(a),direction:a.dataset.direction},direction:b})},sa=a=>
{var b=document.getElementById("trace");const c=b.lastElementChild;b=b.firstElementChild;c.setAttribute("d",a);c.setAttribute("stroke","#ff0000");c.setAttribute("stroke-width",y);b.setAttribute("d",a);b.setAttribute("stroke-width",(1.5*y).toString())};document.getElementById("autoPath").addEventListener("click",va);document.getElementById("undo").addEventListener("click",()=>P({type:"undoTrace"}));document.getElementById("redo").addEventListener("click",()=>P({type:"redoTrace"}));
document.getElementById("clearPath").addEventListener("click",()=>P({type:"clearTrace"}));
document.getElementById("export").addEventListener("click",()=>{const a=c=>Object.values(c).some(d=>d&&"object"===typeof d?a(d):null===d||""===d),b={type:"exportTrace",PPO:document.getElementById("PPO").value||q.D,delim:document.getElementById("delimitation").value||q.delimitation,lowFR:document.getElementById("lowFRExport").value||q.lowFRExport,highFR:document.getElementById("highFRExport").value||q.highFRExport,SPL:{top:document.getElementById("SPLHigher").value,topPixel:G(E.yHigh),bottom:document.getElementById("SPLLower").value,
bottomPixel:G(E.yLow)},FR:{top:document.getElementById("FRHigher").value,topPixel:G(E.xHigh),bottom:document.getElementById("FRLower").value,bottomPixel:G(E.xLow)}};a(b)?h("Please fill in all required values to export (SPL and FR values)"):P(b)});document.getElementById("smoothTrace").addEventListener("click",()=>P({type:"smoothTrace"}));const O=new Map,R=document.getElementById("fileInput");
var wa=document.getElementById("imageQueueInner"),xa=()=>{wa.querySelector('img[class="selectedImage"]').scrollIntoView({inline:"center",behavior:"smooth"})},za=(a,b=!1)=>{const c=document.createElement("img"),d=document.getElementById("imageQueueInner");c.src=a;O.set(c.src,{initial:!0});c.addEventListener("dragstart",f=>f.preventDefault());c.addEventListener("click",f=>{f.preventDefault();f.stopPropagation();C.B();C.src=a;for(const u of wa.querySelectorAll('img[class="selectedImage"]'))u.classList.remove("selectedImage");
c.classList.add("selectedImage");xa()});c.addEventListener("contextmenu",f=>{f.preventDefault();c.classList.contains("selectedImage")&&(f=c.nextElementSibling,f||(f=c.previousElementSibling),f?f.click():ya());O.delete(c.src);P({type:"removeImage",src:c.src});URL.revokeObjectURL(c.src);c.remove()});d.appendChild(c);b&&(c.click(),setTimeout(()=>xa(),50))};document.getElementById("removeImage").addEventListener("click",()=>document.querySelector('img[class="selectedImage"]')?.dispatchEvent(new Event("contextmenu")));
document.getElementById("toggleImageQueue").addEventListener("click",a=>{a=a.target;document.getElementById("imageContainer").addEventListener("transitionend",()=>window.dispatchEvent(new Event("resize")),{once:!0});a.textContent===a.dataset.active?(a.textContent=a.dataset["default"],a.removeAttribute("active")):(a.textContent=a.dataset.active,a.setAttribute("active",""))});aa();ya();
R.l=a=>{a=Array.from(a).filter(c=>c.type.startsWith("image/"));const b=a.length-1;0<a.length?(p(),a.forEach((c,d)=>{c=URL.createObjectURL(c);za(c,d===b)})):h("Invalid image/file(s) added!")};R.addEventListener("change",a=>{R.l(a.target.files)});C.addEventListener("dragstart",a=>a.preventDefault());document.getElementById("fileInputButton").addEventListener("click",()=>R.click());
document.addEventListener("paste",a=>{a.preventDefault();const b=new DataTransfer;for(const c of(a.clipboardData||window?.clipboardData).items)"file"===c.kind&&b.items.add(c.getAsFile());0<b.files.length&&R.l(b.files)});S("dragover",document.body,a=>{a.preventDefault();a.dataTransfer.dropEffect="copy";document.body.classList.add("lowOpacity")});S(["dragleave","dragend"],document.body,a=>{a.preventDefault();document.body.classList.remove("lowOpacity")});
S("drop",document.body,a=>{a.preventDefault();document.body.classList.remove("lowOpacity");R.l(a.dataTransfer.files)});
C.addEventListener("pointermove",a=>{if("erase"!==z){a.preventDefault();const b=C.parentElement,c=b.getBoundingClientRect();a=C.g(a);B.style.left=`${Math.min(a.x-c.left,b.clientWidth-B.clientWidth)}px`;B.style.top=`${Math.min(a.y-c.top,b.clientHeight-B.clientHeight)}px`;B.j.style.left=`${-1*(3*a.xRel-B.clientWidth/2)}px`;B.j.style.top=`${-1*(3*a.yRel-B.clientHeight/2)}px`;P({type:"getPixelColour",x:a.xRel*t,y:a.yRel*t});B.classList.remove("hidden")}});
S(["pointerup","pointerleave","pointerout","pointercancel"],C,()=>B.classList.add("hidden"));let T=null,Aa=C.g;D.addEventListener("pointerdown",a=>{const b=Aa(a);a={x:.02*w,y:.02*x};for(var c of K)c.offset=b[`${c.dataset.direction}Rel`]*t-G(c);c=K.reduce((d,f)=>Math.abs(f.offset)<Math.abs(d.offset)?f:d,K[0]);Math.abs(c.offset)<a[c.dataset.direction]&&(T=c)});D.addEventListener("pointermove",a=>{T&&H(T,Aa(a)[`${T.dataset.direction}Rel`]*t-T.offset)});
S(["pointerup","pointerleave","pointercancel"],D,a=>{a.preventDefault();T=null});let U,Ba,Ca=document.getElementById("snapToLines").checked;document.getElementById("snapToLines").addEventListener("change",()=>Ca=document.getElementById("snapToLines").checked);
document.getElementById("buttonSection").addEventListener("pointerdown",a=>{const b=a.target,c=b.parentNode;!U&&c.classList.contains("moveButtons")&&(a.preventDefault(),Ba=E[c.dataset["for"]],Ca?Q(E[c.dataset["for"]],parseInt(b.dataset.direction,10)):U=setInterval(()=>{H(Ba,G(Ba)+parseInt(b.dataset.direction,10)*t)},10))});S(["pointerup","pointerleave","pointerout","pointercancel"],document.getElementById("buttonSection"),a=>{a.preventDefault();clearInterval(U);U=null});
window.addEventListener("resize",()=>{t=w/C.clientWidth;da();B.o()});const Da={path:(a,b)=>{P({type:"trace",x:a,y:b,colourTolerance:document.getElementById("colourTolerance").value||q.colourTolerance})},point:(a,b)=>P({type:"addPoint",x:a,y:b})};C.addEventListener("click",a=>{null!=z&&(a=C.g(a),Da[z]?.(a.xRel*t,a.yRel*t))});let V=!1;
C.addEventListener("pointerdown",a=>{"erase"===z&&(a.preventDefault(),V=!0,a=C.g(a).xRel*t,ha(),N=Math.max(Math.min(+a,w),0),M.setAttributeNS(null,"x",a),document.addEventListener("pointerup",Ea,{once:!0}))});C.addEventListener("pointermove",a=>{V&&"erase"===z&&(a.preventDefault(),a=C.g(a).xRel*t,a=+a,a<N?(M.setAttributeNS(null,"width",`${N-a}px`),M.setAttributeNS(null,"x",a)):(M.setAttributeNS(null,"width",`${a-N}px`),M.setAttributeNS(null,"x",N.toString())))});
const Ea=a=>{V&&"erase"===z&&(a.preventDefault(),V=!1,a=C.g(a).xRel*t,a=Math.max(Math.min(+a,w),0),ua(...(N<a?[N,a]:[a,N])),M.setAttributeNS(null,"width","0"))};
C.addEventListener("load",()=>{document.getElementById("defaultMainText").classList.add("hidden");for(var a of document.querySelectorAll("[data-disabled]"))a.disabled=!1;ma();w=C.naturalWidth;x=C.naturalHeight;y=.003*Math.max(w,x);t=w/C.clientWidth;ka();for(var b of document.querySelectorAll("svg"))b.setAttribute("width",w),b.setAttribute("height",x),b.setAttribute("viewBox",`0 0 ${w} ${x}`);sa("");B.o();a=O.get(C.src);if(a.initial){document.querySelector('.waiting-overlay[data-for="trace"]').classList.add("enabled");
console.time("Initialise image");b=w;var c=x,d=document.createElement("canvas");const f=d.getContext("2d");d.width=b;d.height=c;f.drawImage(C,0,0);d=f.getImageData(0,0,b,c);ta.postMessage({src:C.src,type:"setData",data:d.data,width:b,height:c},[d.data.buffer]);H(E.xHigh,w);H(E.xLow,0);H(E.yHigh,0);H(E.yLow,x);ea();I();Q(E.xHigh,-1);Q(E.xLow,1);Q(E.yHigh,1);Q(E.yLow,-1);va();a.initial=!1}else P({type:"setCurrent"}),C.A(),P({type:"getCurrentPath"});da()});
const W=new PointerEvent("pointerdown",{bubbles:!0}),X=new PointerEvent("pointerup",{bubbles:!0}),Fa={escape:p,z:a=>a.ctrlKey&&document.getElementById(a.shiftKey?"redo":"undo").click(),a:()=>document.getElementById("autoPath").click(),t:()=>document.getElementById("selectPath").click(),p:()=>document.getElementById("selectPoint").click(),h:()=>document.getElementById("toggleImageQueue").click(),s:a=>document.getElementById(a.ctrlKey?"export":"smoothTrace").click(),e:()=>document.getElementById("eraseRegion").click(),
enter:()=>document.getElementById("fileInputButton").click(),"delete":()=>document.getElementById("removeImage").click(),backspace:()=>document.getElementById("clearPath").click(),arrowup:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(W),arrowdown:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(W),arrowleft:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(W),
arrowright:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(W)},Ga={arrowup:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(X),arrowdown:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(X),arrowleft:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(X),arrowright:a=>document.querySelector(`[data-for="x${a.shiftKey?
"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(X)};document.addEventListener("keydown",a=>{const b=Fa[a.key.toLowerCase()];!a.target.closest("input")&&b&&(a.preventDefault(),b(a))});document.addEventListener("keyup",a=>{const b=Ga[a.key.toLowerCase()];!a.target.closest("input")&&b&&(a.preventDefault(),b(a))});function S(a,b,c){for(const d of Array.isArray(a)?a:[a])b.addEventListener(d,c)}
function ya(){document.getElementById("defaultMainText").classList.remove("hidden");for(const a of document.querySelectorAll("[data-disabled]"))a.disabled=!0;ma();J();ka();sa("");C.src=""}const Ha=a=>{a=a.target;a.value<a.min&&(a.value=a.min)};for(const a of["FRLower","colourTolerance","lowFRExport"])document.getElementById(a).addEventListener("change",Ha);const Y=[{i:"Welcome to UsyTrace",body:"<h2>Here you can trace frequency responses from images</h2>\n\nAll you need to know, as well as keybindings are on the next few pages"},{i:"Tracing",body:"<h3>Auto Trace (a)</h3>\nTries to automatically select a line in the image, may fail, applied automatically upon image import\n    \n<h3>Select Path (t)</h3>\nTraces to the right of the point you click on the image, can complete a trace by starting from the left side of the frequency response and clicking to the right if it misses a part\n\n<h3>Add Point (p)</h3>\nAdd a single point to the trace manually, useful for situations where Select Path or Auto Trace Fails\n\n<h3>Smooth Trace (s)</h3>\nSmooths out sudden bumps in the traced line, good for if the original image is bad and the traced line is inconsistent\n\n<h3>Undo (Ctrl + z)</h3>\nGoes back to the previous trace step, saves add point, tracing, and clearing history\n\n<h3>Redo (Ctrl + Shift + z)</h3>\nGoes back to recently undone trace steps\n\n<h3>Erase Region (e)</h3>\nSelect a region to erase a trace from by dragging a box around the area\n\n<h3>Clear Path (Backspace)</h3>\nClears the current trace on screen, can go back using Undo"},
{i:"Exporting",body:"Align <b>High</b> and <b>Low</b> lines with given values in their respective axis, then input the respective values into <b>Higher SPL</b>, <b>Lower SPL</b>, <b>Higher Frequency</b> and <b>Lower Frequency</b>.\n\nThe lines can be moved with the arrow keys, defaulting to the <b>High</b> line for each axis, but can control the <b>Low</b> line by holding <b>Shift</b>\n\n<h3>Trace Settings</h3>     \nAdjust the <b>Minimum Exported Frequency</b>, <b>Maximum Exported Frequency</b>, <b>Points Per Octave of the exported data</b>, and <b>the delimitation of the exported data</b>\n\nThen <b>Export Trace</b> will give you the result"},
{i:"Settings",body:"<h3>Buttons Snap To Axis</h3>\nwhether the buttons underneath the Export values will attempt to snap the lines to their axis, or to enable smooth manual movement\n    \n<h3>Colour Tolerance</h3>\nRaise if line is not being detected, Lower if line is jagged or detecting multiple lines"},{i:"Miscellaneous",body:"You can <b>drop</b>, or <b>choose any amount of images</b> you like into the site, other than with pasting, as that only supports one image at a time.\n    \nLoaded images show in the image queue on the bottom, and can be removed by right-clicking them (long hold on mobile), pressing <b>Remove</b> or pressing the <b>Delete</b> key on your keyboard"}];
let Z=0;var Ia;try{Ia=parseInt(window.localStorage.getItem("USER_TUTORIAL_VERSION")??0,10)}catch{Ia=0}2!==Ia&&Ja();
function Ja(){function a(){Z>=Y.length-1?m.textContent="End Tutorial":0>=Z?(m.textContent="Begin Tutorial",k.disabled=!0,k.textContent=""):(m.textContent="Next",k.disabled=!1,k.textContent="Previous");b()}function b(){const r=Y[Z]??Y[0];u.textContent=r.i;v.innerHTML=r.body}Z=0;const c=document.createElement("div"),d=document.createElement("div");d.classList.add("popupButtons");c.classList.add("popupText");const f=document.createElement("div"),u=document.createElement("h1"),l=document.createElement("button");
f.classList.add("headContainer");l.classList.add("standardButton");l.textContent="\ud800\udf22";l.addEventListener("click",p);f.append(u,l);const v=document.createElement("p");c.append(v);const m=document.createElement("button"),k=document.createElement("button");m.classList.add("standardButton");k.classList.add("standardButton");m.addEventListener("click",()=>{Z>=Y.length-1&&l.click();++Z;a()});k.addEventListener("click",()=>{--Z;a()});a();b();d.append(k,m);h([f,c,d],{buttons:d,u:["fixedSize"],onclose:Ka})}
function Ka(){window.localStorage.setItem("USER_TUTORIAL_VERSION",(2).toString())}document.getElementById("tutorial").addEventListener("click",Ja);document.getElementById("about").addEventListener("click",()=>{const a=document.createElement("div");a.classList.add("popupInner","about");const b=document.createElement("div");let c=null;const d=document.createElement("div");d.classList.add("logo");b.appendChild(d);b.classList.add("logoWrapper");var f=document.createElement("div"),u=document.createElement("div"),l=document.createElement("div");f.classList.add("wall");u.classList.add("wall");l.classList.add("wall");var v=document.createElement("div");
for(var m=0;16>m;++m){var k=document.createElement("div");k.style.setProperty("--i",m.toString());v.appendChild(k)}v.classList.add("line");d.append(f,u,l,v);let r,n;b.addEventListener("pointermove",L=>{L.target===L.currentTarget&&(clearTimeout(r),c=c??b.getBoundingClientRect(),d.style.setProperty("--dy",`${(L.clientX-c.left-c.width/2)/5}deg`),d.style.setProperty("--dx",`${(c.height/2-(L.clientY-c.top))/5}deg`),null==n&&(d.classList.add("quick"),n=setTimeout(()=>{d.classList.add("no-transition");d.classList.remove("quick")},
200)))});b.addEventListener("pointerleave",()=>{clearTimeout(n);n=null;r=setTimeout(()=>{d.classList.remove("quick");d.classList.remove("no-transition");d.style.removeProperty("--dx");d.style.removeProperty("--dy")},100)});b.addEventListener("dragstart",L=>L.preventDefault());f=document.createElement("div");f.classList.add("popupInner");u=document.createElement("h2");u.textContent="UsyTrace";l=document.createElement("h3");l.textContent="made with \u2764\ufe0f by usy";v=document.createElement("h6");
v.textContent="i made the 3d icon while procrastinating studying for exams, try hovering over it or dragging it";m=document.createElement("div");m.textContent="Find me at:";k=document.createElement("div");k.textContent="Discord: @usy_";const ia=document.createElement("div");var F=document.createElement("a");ia.textContent="Email: ";F.href="mailto:usy@usyless.uk";F.textContent="usy@usyless.uk";ia.appendChild(F);F=document.createElement("div");const ja=document.createElement("a");F.textContent="GitHub: ";
ja.href="https://github.com/usyless/UsyTrace/issues";ja.textContent="usyless";F.appendChild(ja);f.append(u,l,m,k,ia,F,v);a.append(b,f);h(a,{v:[{target:window,type:"resize",listener:()=>{c=b.getBoundingClientRect()}}]})});"serviceWorker"in navigator&&!["localhost","127.0.0.1"].includes(location.hostname)&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}),navigator.serviceWorker.register("./service-worker.js").then(a=>{a.addEventListener("updatefound",()=>{const b=a.installing;b.addEventListener("statechange",()=>{if("installed"===b.state&&navigator.serviceWorker.controller){const c=document.getElementById("updateAvailable");c.addEventListener("click",()=>{b.postMessage({action:"skipWaiting"})});
c.classList.remove("hidden")}})})}));
