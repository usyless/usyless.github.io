var e=!0;const g=[],n=[];
async function r(a,{A:b=[],buttons:c,v:d=[],onclose:f}={}){u();e=!1;return new Promise(p=>{const l=document.createElement("div"),q=document.createElement("div"),m=document.createElement("div");l.setAttribute("usy-overlay","");l.classList.add("fullscreen","blur");q.classList.add("popupOuter",...d);m.classList.add("popupInner",...d);const k=[];if("string"===typeof a){var t=document.createElement("div");t.classList.add("popupText");t.textContent=a;k.push(t)}else Array.isArray(a)?k.push(...a):k.push(a);
q.appendChild(m);if(null!=c)t=c;else{t=document.createElement("div");t.classList.add("popupButtons");const h=document.createElement("button");h.classList.add("standardButton");h.textContent="Ok";t.appendChild(h);h.addEventListener("click",()=>{u();p(!0)})}m.append(...k,t);l.addEventListener("click",h=>{h.target===h.currentTarget&&(u(),p(!1))});l.appendChild(q);b.push({target:window,type:"keydown",listener:h=>{"escape"===h.key.toLowerCase()&&l.click()},u:{once:!0}});for(const h of b)g.push(h),h.target.addEventListener(h.type,
h.listener,h.u??{});null!=f&&n.push(f);document.body.appendChild(l)})}function u(){e=!0;for(const a of g)a.target?.removeEventListener?.(a.type,a.listener);for(const a of n)a();n.length=0;g.length=0;document.querySelectorAll("[usy-overlay]").forEach(a=>a.remove())};const v={FRHigher:2E4,FRLower:20,colourTolerance:67,PPO:48,delimitation:"tab",lowFRExport:20,highFRExport:2E4,SPLHigher:"",SPLLower:""};document.getElementById("restoreDefault").addEventListener("click",()=>{aa();r("Restored settings to default")});function aa(){for(const a in v)document.getElementById(a).value=v[a]}let w,x,y,z,A=null,B=null;const C=document.getElementById("glass");C.j=C.querySelector("img");C.D=a=>{C.style.borderColor=`rgb(${a})`};
C.o=()=>{D.l()&&(C.j.src=D.src,C.j.width=3*D.clientWidth,C.j.height=3*D.clientHeight)};
var ba=()=>{document.querySelector('.waiting-overlay[data-for="trace"]').classList.remove("enabled")},E=document.getElementById("lines"),F={xHigh:document.getElementById("xHigh"),xLow:document.getElementById("xLow"),yHigh:document.getElementById("yHigh"),yLow:document.getElementById("yLow")},ca=(a,b)=>{const c=a.dataset.direction;a.nextElementSibling.setAttribute(c,b);a.setAttribute(`${c}1`,b);a.setAttribute(`${c}2`,b)},da=()=>{for(const a of E.querySelectorAll("line"))a.setAttribute("stroke-width",
w);for(const a of E.querySelectorAll("text"))a.setAttribute("font-size",`${1.3*w}em`)},G=a=>parseFloat(a.getAttribute(`${a.dataset.direction}1`)),I=(a,b)=>{const c=G(F[a.dataset.other]),d="x"===a.dataset.direction?x:y;a===F.xHigh||a===F.yLow?ca(a,Math.max(c+1,Math.min(d-1,b))):ca(a,Math.max(1,Math.min(c-1,b)))},J=()=>E.classList.remove("hidden"),K=()=>E.classList.add("hidden"),ea=()=>{for(const a in F){const b=F[a],[c,d]="x"===b.dataset.direction?["y",y]:["x",x];b.setAttribute(`${c}1`,0);b.setAttribute(`${c}2`,
d)}F.xHigh.nextElementSibling.setAttribute("y",(y/2).toString());F.xLow.nextElementSibling.setAttribute("y",(y/2).toString());F.yHigh.nextElementSibling.setAttribute("x",(x/2).toString());F.yLow.nextElementSibling.setAttribute("x",(x/2).toString())},fa=[F.xHigh,F.xLow,F.yHigh,F.yLow],ia=()=>{ha.classList.remove("hidden");M.setAttributeNS(null,"width","0")},la=()=>{document.getElementById("erasing").classList.add("hidden")},ha,M,N;ha=document.getElementById("erasing");M=ha.firstElementChild;
const D=document.getElementById("uploadedImage");D.g=a=>{const b=D.getBoundingClientRect(),c=a.clientX;a=a.clientY;return{x:c,y:a,xRel:c-b.left,yRel:a-b.top}};D.l=()=>D.src.startsWith("blob:");D.C=()=>{const a=O.get(D.src),b={};if(a){for(const c in F)b[c]=G(F[c]);a.lines=b}};D.B=()=>{const a=O.get(D.src).lines;for(const b in F)I(F[b],a[b]);ea();J()};const ma=a=>{r(a).then(()=>ma(a)).catch(()=>ma(a))};
var na=()=>{for(const a of document.querySelectorAll("#sidebar [data-default]"))a.textContent=a.dataset["default"];A=null;B?.()},oa=a=>{document.getElementById("undo").disabled=!a.undo;document.getElementById("redo").disabled=!a.redo};
const pa=["selectPath","selectPoint","eraseRegion"],qa={path:K,point:K,erase:()=>{K();ia()}},ra={path:J,point:J,erase:()=>{la();J()}},sa=a=>{a=a.target;const b=a.dataset.mode,c=JSON.parse(JSON.stringify(A));na();c===b?(B?.(),A=null):(a.textContent=a.dataset.active,B?.(),B=ra[b],A=b,qa[b]())};for(const a of pa)document.getElementById(a).addEventListener("click",sa);
var ua=(()=>{const a=new Worker("./a.out.js");a.onmessage=b=>{b=b.data;const c=b.type;switch(c){case "exportTrace":const d=document.createElement("a"),f=URL.createObjectURL(new Blob([b["export"]],{type:"text/plain;charset=utf-8"}));d.href=f;d.download="trace.txt";document.body.appendChild(d);d.click();setTimeout(()=>{document.body.removeChild(d);window.URL.revokeObjectURL(f)},0);break;case "error":ba();ma(b.message);break;case "getHistoryStatus":oa(b);break;case "setData":console.timeEnd("Initialise image");
break;default:D.src===b.src&&("getPixelColour"===c?C.D(b.pixelColour):"snapLine"===c?I(F[b.line.name],b.line.position):(ta(b.svg),ba(),P({type:"getHistoryStatus"})))}};return a})(),P=a=>D.l()&&ua.postMessage({src:D.src,...a}),va=(a,b)=>{P({type:"eraseRegion",begin:a,end:b})},wa=()=>{P({type:"autoTrace",colourTolerance:document.getElementById("colourTolerance").value||v.colourTolerance})},Q=(a,b)=>{P({type:"snapLine",line:{name:a.id,position:G(a),direction:a.dataset.direction},direction:b})},ta=a=>
{var b=document.getElementById("trace");const c=b.lastElementChild;b=b.firstElementChild;c.setAttribute("d",a);c.setAttribute("stroke","#ff0000");c.setAttribute("stroke-width",z);b.setAttribute("d",a);b.setAttribute("stroke-width",(1.5*z).toString())};document.getElementById("autoPath").addEventListener("click",wa);document.getElementById("undo").addEventListener("click",()=>P({type:"undoTrace"}));document.getElementById("redo").addEventListener("click",()=>P({type:"redoTrace"}));
document.getElementById("clearPath").addEventListener("click",()=>P({type:"clearTrace"}));
document.getElementById("export").addEventListener("click",()=>{const a=c=>Object.values(c).some(d=>d&&"object"===typeof d?a(d):null==d||""===d),b={type:"exportTrace",PPO:document.getElementById("PPO").value||v.F,delim:document.getElementById("delimitation").value||v.delimitation,lowFR:document.getElementById("lowFRExport").value||v.lowFRExport,highFR:document.getElementById("highFRExport").value||v.highFRExport,SPL:{top:document.getElementById("SPLHigher").value,topPixel:G(F.yHigh),bottom:document.getElementById("SPLLower").value,
bottomPixel:G(F.yLow)},FR:{top:document.getElementById("FRHigher").value,topPixel:G(F.xHigh),bottom:document.getElementById("FRLower").value,bottomPixel:G(F.xLow)}};a(b)?r("Please fill in all required values to export (SPL and FR values)"):P(b)});document.getElementById("smoothTrace").addEventListener("click",()=>P({type:"smoothTrace"}));const O=new Map,R=document.getElementById("fileInput");
var xa=document.getElementById("imageQueueInner"),ya=()=>{xa.querySelector('img[class="selectedImage"]').scrollIntoView({inline:"center",behavior:"smooth"})},Aa=(a,b=!1)=>{const c=document.createElement("img"),d=document.getElementById("imageQueueInner");c.src=a;O.set(c.src,{initial:!0});c.addEventListener("dragstart",f=>f.preventDefault());c.addEventListener("click",f=>{f.preventDefault();f.stopPropagation();D.C();D.src=a;for(const p of xa.querySelectorAll('img[class="selectedImage"]'))p.classList.remove("selectedImage");
c.classList.add("selectedImage");ya()});c.addEventListener("contextmenu",f=>{f.preventDefault();c.classList.contains("selectedImage")&&(f=c.nextElementSibling,f||(f=c.previousElementSibling),f?f.click():za());O.delete(c.src);P({type:"removeImage",src:c.src});URL.revokeObjectURL(c.src);c.remove()});d.appendChild(c);b&&(c.click(),setTimeout(()=>ya(),50))};document.getElementById("removeImage").addEventListener("click",()=>document.querySelector('img[class="selectedImage"]')?.dispatchEvent(new Event("contextmenu")));
document.getElementById("toggleImageQueue").addEventListener("click",a=>{a=a.target;document.getElementById("imageContainer").addEventListener("transitionend",()=>window.dispatchEvent(new Event("resize")),{once:!0});a.textContent===a.dataset.active?(a.textContent=a.dataset["default"],a.removeAttribute("active")):(a.textContent=a.dataset.active,a.setAttribute("active",""))});
document.getElementById("editImage").addEventListener("click",()=>{if(D.l()){const d=document.createElement("div");var a=document.createElement("h3"),b=document.createElement("div"),c=document.createElement("button");const f=document.createElement("div"),p=document.createElement("img");d.id="editContainer";d.append(a,b,f);f.append(p);f.classList.add("cropWrapper");a.textContent="Crop/Edit Image";b.appendChild(c);c.textContent="Invert";c.classList.add("standardButton");p.src=D.src;c.addEventListener("click",
()=>p.classList.toggle("inverted"));a=document.createElement("div");a.classList.add("popupButtons");b=document.createElement("button");c=document.createElement("button");b.classList.add("standardButton");b.textContent="Cancel";c.classList.add("standardButton");c.textContent="Save";a.append(b,c);b.addEventListener("click",u);c.addEventListener("click",()=>{const l=document.createElement("canvas"),q=l.getContext("2d");l.width=x;l.height=y;q.drawImage(p,0,0);if(p.classList.contains("inverted")){const m=
q.getImageData(0,0,x,y),k=m.data,t=k.length;for(let h=0;h<t;h+=4)k[h]=255-k[h],k[h+1]=255-k[h+1],k[h+2]=255-k[h+2];q.putImageData(m,0,0)}document.getElementById("removeImage").click();l.toBlob(m=>{Aa(URL.createObjectURL(m),!0);u()})},{once:!0});r(d,{buttons:a})}else r("No valid image selected")});aa();za();R.m=a=>{a=Array.from(a).filter(c=>c.type.startsWith("image/"));const b=a.length-1;0<a.length?(u(),a.forEach((c,d)=>{c=URL.createObjectURL(c);Aa(c,d===b)})):r("Invalid image/file(s) added!")};
R.addEventListener("change",a=>{R.m(a.target.files)});D.addEventListener("dragstart",a=>a.preventDefault());document.getElementById("fileInputButton").addEventListener("click",()=>R.click());document.addEventListener("paste",a=>{a.preventDefault();const b=new DataTransfer;for(const c of a.clipboardData.items)"file"===c.kind&&b.items.add(c.getAsFile());0<b.files.length&&R.m(b.files)});S("dragover",document.body,a=>{a.preventDefault();a.dataTransfer.dropEffect="copy";document.body.classList.add("lowOpacity")});
S(["dragleave","dragend"],document.body,a=>{a.preventDefault();document.body.classList.remove("lowOpacity")});S("drop",document.body,a=>{a.preventDefault();document.body.classList.remove("lowOpacity");R.m(a.dataTransfer.files)});
D.addEventListener("pointermove",a=>{if("erase"!==A){a.preventDefault();const b=D.parentElement,c=b.getBoundingClientRect();a=D.g(a);C.style.left=`${Math.min(a.x-c.left,b.clientWidth-C.clientWidth)}px`;C.style.top=`${Math.min(a.y-c.top,b.clientHeight-C.clientHeight)}px`;C.j.style.left=`${-1*(3*a.xRel-C.clientWidth/2)}px`;C.j.style.top=`${-1*(3*a.yRel-C.clientHeight/2)}px`;P({type:"getPixelColour",x:a.xRel*w,y:a.yRel*w});C.classList.remove("hidden")}});
S(["pointerleave","pointerout","pointercancel"],D,()=>C.classList.add("hidden"));let T=null,Ba=D.g;E.addEventListener("pointerdown",a=>{const b=Ba(a);a={x:.02*x,y:.02*y};for(var c of fa)c.offset=b[`${c.dataset.direction}Rel`]*w-G(c);c=fa.reduce((d,f)=>Math.abs(f.offset)<Math.abs(d.offset)?f:d,fa[0]);Math.abs(c.offset)<a[c.dataset.direction]&&(T=c)});E.addEventListener("pointermove",a=>{T&&I(T,Ba(a)[`${T.dataset.direction}Rel`]*w-T.offset)});
S(["pointerup","pointerleave","pointercancel"],E,a=>{a.preventDefault();T=null});let U,Ca,Da=document.getElementById("snapToLines").checked;document.getElementById("snapToLines").addEventListener("change",()=>Da=document.getElementById("snapToLines").checked);
document.getElementById("buttonSection").addEventListener("pointerdown",a=>{const b=a.target,c=b.parentNode;!U&&c.classList.contains("moveButtons")&&(a.preventDefault(),Ca=F[c.dataset["for"]],Da?Q(F[c.dataset["for"]],parseInt(b.dataset.direction,10)):U=setInterval(()=>{I(Ca,G(Ca)+parseInt(b.dataset.direction,10)*w)},10))});S(["pointerup","pointerleave","pointerout","pointercancel"],document.getElementById("buttonSection"),a=>{a.preventDefault();clearInterval(U);U=null});
window.addEventListener("resize",()=>{w=x/D.clientWidth;da();C.o()});const Ea={path:(a,b)=>{P({type:"trace",x:a,y:b,colourTolerance:document.getElementById("colourTolerance").value||v.colourTolerance})},point:(a,b)=>P({type:"addPoint",x:a,y:b})};D.addEventListener("click",a=>{null!=A&&(a=D.g(a),Ea[A]?.(a.xRel*w,a.yRel*w))});let V=!1;
D.addEventListener("pointerdown",a=>{"erase"===A&&(a.preventDefault(),V=!0,a=D.g(a).xRel*w,ia(),N=Math.max(Math.min(+a,x),0),M.setAttributeNS(null,"x",a),document.addEventListener("pointerup",Fa,{once:!0}))});D.addEventListener("pointermove",a=>{V&&"erase"===A&&(a.preventDefault(),a=D.g(a).xRel*w,a=+a,a<N?(M.setAttributeNS(null,"width",`${N-a}px`),M.setAttributeNS(null,"x",a)):(M.setAttributeNS(null,"width",`${a-N}px`),M.setAttributeNS(null,"x",N.toString())))});
const Fa=a=>{V&&"erase"===A&&(a.preventDefault(),V=!1,a=D.g(a).xRel*w,a=Math.max(Math.min(+a,x),0),va(...(N<a?[N,a]:[a,N])),M.setAttributeNS(null,"width","0"))};
D.addEventListener("load",()=>{document.getElementById("defaultMainText").classList.add("hidden");for(var a of document.querySelectorAll("[data-disabled]"))a.disabled=!1;na();x=D.naturalWidth;y=D.naturalHeight;z=.003*Math.max(x,y);w=x/D.clientWidth;la();for(var b of document.querySelectorAll("svg"))b.setAttribute("width",x),b.setAttribute("height",y),b.setAttribute("viewBox",`0 0 ${x} ${y}`);ta("");C.o();a=O.get(D.src);if(a.initial){document.querySelector('.waiting-overlay[data-for="trace"]').classList.add("enabled");
console.time("Initialise image");b=x;var c=y,d=document.createElement("canvas");const f=d.getContext("2d");d.width=b;d.height=c;f.drawImage(D,0,0);d=f.getImageData(0,0,b,c);ua.postMessage({src:D.src,type:"setData",data:d.data,width:b,height:c},[d.data.buffer]);I(F.xHigh,x);I(F.xLow,0);I(F.yHigh,0);I(F.yLow,y);ea();J();Q(F.xHigh,-1);Q(F.xLow,1);Q(F.yHigh,1);Q(F.yLow,-1);wa();a.initial=!1}else P({type:"setCurrent"}),D.B(),P({type:"getCurrentPath"});da()});
const W=new PointerEvent("pointerdown",{bubbles:!0}),X=new PointerEvent("pointerup",{bubbles:!0}),Ga={z:a=>a.ctrlKey&&document.getElementById(a.shiftKey?"redo":"undo").click(),a:()=>document.getElementById("autoPath").click(),t:()=>document.getElementById("selectPath").click(),p:()=>document.getElementById("selectPoint").click(),h:()=>document.getElementById("toggleImageQueue").click(),s:a=>document.getElementById(a.ctrlKey?"export":"smoothTrace").click(),e:a=>document.getElementById(a.ctrlKey?"editImage":
"eraseRegion").click(),enter:()=>document.getElementById("fileInputButton").click(),"delete":()=>document.getElementById("removeImage").click(),backspace:()=>document.getElementById("clearPath").click(),arrowup:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(W),arrowdown:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(W),arrowleft:a=>document.querySelector(`[data-for="x${a.shiftKey?
"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(W),arrowright:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(W)},Ha={arrowup:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(X),arrowdown:a=>document.querySelector(`[data-for="y${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(X),arrowleft:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="-1"]`).dispatchEvent(X),
arrowright:a=>document.querySelector(`[data-for="x${a.shiftKey?"Low":"High"}"] > [data-direction="1"]`).dispatchEvent(X)};document.addEventListener("keydown",a=>{if(e){const b=Ga[a.key.toLowerCase()];!a.target.closest("input")&&b&&(a.preventDefault(),b(a))}});document.addEventListener("keyup",a=>{if(e){const b=Ha[a.key.toLowerCase()];!a.target.closest("input")&&b&&(a.preventDefault(),b(a))}});function S(a,b,c){for(const d of Array.isArray(a)?a:[a])b.addEventListener(d,c)}
function za(){document.getElementById("defaultMainText").classList.remove("hidden");for(const a of document.querySelectorAll("[data-disabled]"))a.disabled=!0;na();K();la();ta("");D.src=""}const Ia=a=>{a=a.target;a.value<a.min&&(a.value=a.min)};for(const a of["FRLower","colourTolerance","lowFRExport"])document.getElementById(a).addEventListener("change",Ia);const Y=[{i:"Welcome to UsyTrace",body:"<h2>Here you can trace frequency responses from images</h2>\n\nAll you need to know, as well as keybindings are on the next few pages"},{i:"Tracing",body:"<h3>Auto Trace (a)</h3>\nTries to automatically select a line in the image, may fail, applied automatically upon image import\n    \n<h3>Select Path (t)</h3>\nTraces to the right of the point you click on the image, can complete a trace by starting from the left side of the frequency response and clicking to the right if it misses a part\n\n<h3>Add Point (p)</h3>\nAdd a single point to the trace manually, useful for situations where Select Path or Auto Trace Fails\n\n<h3>Smooth Trace (s)</h3>\nSmooths out sudden bumps in the traced line, good for if the original image is bad and the traced line is inconsistent\n\n<h3>Undo (Ctrl + z)</h3>\nGoes back to the previous trace step, saves add point, tracing, and clearing history\n\n<h3>Redo (Ctrl + Shift + z)</h3>\nGoes back to recently undone trace steps\n\n<h3>Erase Region (e)</h3>\nSelect a region to erase a trace from by dragging a box around the area\n\n<h3>Clear Path (Backspace)</h3>\nClears the current trace on screen, can go back using Undo"},
{i:"Exporting",body:"Align <b>High</b> and <b>Low</b> lines with given values in their respective axis, then input the respective values into <b>Higher SPL</b>, <b>Lower SPL</b>, <b>Higher Frequency</b> and <b>Lower Frequency</b>.\n\nThe lines can be moved with the arrow keys, defaulting to the <b>High</b> line for each axis, but can control the <b>Low</b> line by holding <b>Shift</b>\n\n<h3>Trace Settings</h3>     \nAdjust the <b>Minimum Exported Frequency</b>, <b>Maximum Exported Frequency</b>, <b>Points Per Octave of the exported data</b>, and <b>the delimitation of the exported data</b>\n\nThen <b>Export Trace</b> will give you the result"},
{i:"Settings",body:"<h3>Buttons Snap To Axis</h3>\nwhether the buttons underneath the Export values will attempt to snap the lines to their axis, or to enable smooth manual movement\n    \n<h3>Colour Tolerance</h3>\nRaise if line is not being detected, Lower if line is jagged or detecting multiple lines"},{i:"Miscellaneous",body:"You can <b>drop</b>, or <b>choose any amount of images</b> you like into the site, other than with pasting, as that only supports one image at a time.\n\n<h3>Image Editing (Ctrl + e)</h3>\nHere you can apply filters to the image that may make it trace better.\n\n<h3>Image Queue</h3>\nLoaded images show in the image queue on the bottom, and can be removed by right-clicking them (long hold on mobile), pressing <b>Remove</b> or pressing the <b>Delete</b> key on your keyboard"}];
let Z=0;var Ja;try{Ja=parseInt(window.localStorage.getItem("USER_TUTORIAL_VERSION")??0,10)}catch{Ja=0}3!==Ja&&Ka();
function Ka(){function a(){Z>=Y.length-1?m.textContent="End Tutorial":0>=Z?(m.textContent="Begin Tutorial",k.disabled=!0,k.textContent=""):(m.textContent="Next",k.disabled=!1,k.textContent="Previous");b()}function b(){const t=Y[Z]??Y[0];p.textContent=t.i;q.innerHTML=t.body}Z=0;const c=document.createElement("div"),d=document.createElement("div");d.classList.add("popupButtons");c.classList.add("popupText");const f=document.createElement("div"),p=document.createElement("h1"),l=document.createElement("button");
f.classList.add("headContainer");l.classList.add("standardButton");l.textContent="\ud800\udf22";l.addEventListener("click",u);f.append(p,l);const q=document.createElement("p");c.append(q);const m=document.createElement("button"),k=document.createElement("button");m.classList.add("standardButton");k.classList.add("standardButton");m.addEventListener("click",()=>{Z>=Y.length-1&&l.click();++Z;a()});k.addEventListener("click",()=>{--Z;a()});a();b();d.append(k,m);r([f,c,d],{buttons:d,v:["fixedSize"],onclose:La})}
function La(){window.localStorage.setItem("USER_TUTORIAL_VERSION",(3).toString())}document.getElementById("tutorial").addEventListener("click",Ka);document.getElementById("about").addEventListener("click",()=>{const a=document.createElement("div");a.classList.add("popupInner","about");const b=document.createElement("div");let c=null;const d=document.createElement("div");d.classList.add("logo");b.appendChild(d);b.classList.add("logoWrapper");var f=document.createElement("div"),p=document.createElement("div"),l=document.createElement("div");f.classList.add("wall");p.classList.add("wall");l.classList.add("wall");var q=document.createElement("div");
for(var m=0;16>m;++m){var k=document.createElement("div");k.style.setProperty("--i",m.toString());q.appendChild(k)}q.classList.add("line");d.append(f,p,l,q);let t,h;b.addEventListener("pointermove",L=>{L.target===L.currentTarget&&(clearTimeout(t),c=c??b.getBoundingClientRect(),d.style.setProperty("--dy",`${(L.clientX-c.left-c.width/2)/5}deg`),d.style.setProperty("--dx",`${(c.height/2-(L.clientY-c.top))/5}deg`),null==h&&(d.classList.add("quick"),h=setTimeout(()=>{d.classList.add("no-transition");d.classList.remove("quick")},
200)))});b.addEventListener("pointerleave",()=>{clearTimeout(h);h=null;t=setTimeout(()=>{d.classList.remove("quick");d.classList.remove("no-transition");d.style.removeProperty("--dx");d.style.removeProperty("--dy")},100)});b.addEventListener("dragstart",L=>L.preventDefault());f=document.createElement("div");f.classList.add("popupInner");p=document.createElement("h2");p.textContent="UsyTrace";l=document.createElement("h3");l.textContent="made with \u2764\ufe0f by usy";q=document.createElement("h6");
q.textContent="i made the 3d icon while procrastinating studying for exams, try hovering over it or dragging it";m=document.createElement("div");m.textContent="Find me at:";k=document.createElement("div");k.textContent="Discord: @usy_";const ja=document.createElement("div");var H=document.createElement("a");ja.textContent="Email: ";H.href="mailto:usy@usyless.uk";H.textContent="usy@usyless.uk";ja.appendChild(H);H=document.createElement("div");const ka=document.createElement("a");H.textContent="GitHub: ";
ka.href="https://github.com/usyless/UsyTrace/issues";ka.textContent="usyless";H.appendChild(ka);f.append(p,l,m,k,ja,H,q);a.append(b,f);r(a,{A:[{target:window,type:"resize",listener:()=>{c=b.getBoundingClientRect()}}]})});"serviceWorker"in navigator&&!["localhost","127.0.0.1"].includes(location.hostname)&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}),navigator.serviceWorker.register("./service-worker.js").then(a=>{a.addEventListener("updatefound",()=>{const b=a.installing;b.addEventListener("statechange",()=>{if("installed"===b.state&&navigator.serviceWorker.controller){const c=document.getElementById("updateAvailable");c.addEventListener("click",()=>{b.postMessage({action:"skipWaiting"})});
c.classList.remove("hidden")}})})}));
