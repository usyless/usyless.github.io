var c;c||=typeof Module != 'undefined' ? Module : {};const l=[];self.onmessage=b=>l.push(b);
c.onRuntimeInitialized=()=>{const b=TextDecoder.prototype.decode.bind(new TextDecoder("utf-8"));var d=a=>(...f)=>{f=a(...f);return b(new Uint8Array(m.buffer,n[f/4],n[f/4+1]))};const g=new Map,e={C:c._create_buffer,M:a=>c._setCurrent(g.get(a)),A:(a,f,k,q)=>g.set(a,c._addImage(f,k,q)),L:a=>{c._removeImage(g.get(a));g.delete(a)},H:c._historyStatus,O:d(c._trace),offsetTrace:d(c._offsetTrace),J:d(c._point),P:d(c._undo),K:d(c._redo),F:d(c._eraseRegion),smooth:d(c._smoothTrace),clear:c._clear,B:d(c._autoTrace),
G:d(c._exportTrace),N:c._snap,I:c._getPixelColour,D:d(c._getCurrentPath)},h=(a,f)=>{a.svg=f;return a},B={setCurrent:({src:a})=>e.M(a),removeImage:({src:a})=>e.L(a),setData:({src:a,type:f,width:k,height:q,data:K})=>{const A=e.C(parseInt(k,10),parseInt(q,10));m.set(K,A);e.A(a,A,parseInt(k,10),parseInt(q,10));return{src:a,type:f}},getHistoryStatus:a=>{const f=e.H();a.undo=!!((f&2)>>1);a.redo=!!(f&1);return a},clearTrace:a=>h(a,e.clear()),undoTrace:a=>h(a,e.P()),redoTrace:a=>h(a,e.K()),eraseRegion:a=>
h(a,e.F(parseInt(a.begin,10),parseInt(a.end,10))),smoothTrace:a=>h(a,e.smooth()),exportTrace:a=>{a["export"]=e.G(parseInt(a.PPO,10),"tab"===a.delim?1:0,parseFloat(a.lowFR),parseFloat(a.highFR),parseFloat(a.SPL.top),parseFloat(a.SPL.topPixel),parseFloat(a.SPL.bottom),parseFloat(a.SPL.bottomPixel),parseFloat(a.FR.top),parseFloat(a.FR.topPixel),parseFloat(a.FR.bottom),parseFloat(a.FR.bottomPixel));return a},addPoint:a=>h(a,e.J(parseInt(a.x,10),parseInt(a.y,10))),autoTrace:a=>h(a,e.B(parseInt(a.colourTolerance,
10))),trace:a=>h(a,e.O(parseInt(a.x,10),parseInt(a.y,10),parseInt(a.colourTolerance,10))),offsetTrace:a=>h(a,e.offsetTrace(parseInt(a.direction,10),parseInt(a.magnitude,10))),snapLine:a=>{a.line.position=e.N(parseInt(a.line.position,10),"x"===a.line.direction?1:0,parseInt(a.direction,10));return a},getPixelColour:a=>{const f=e.I(parseInt(a.x,10),parseInt(a.y,10));a.pixelColour=`${f>>16}, ${f>>8&255}, ${f&255}`;return a},getCurrentPath:a=>h(a,e.D())};d=({data:a})=>{let f;try{f=B[a.type](a)}catch(k){console.error(k.message),
f={type:"error",message:"Out of memory, please refresh the site. (You must have loaded a LOT of images at once)"}}f&&postMessage(f)};self.onmessage=d;for(const a of l)d(a);l.length=0};var p;p=self.location.href;var r="",t,u;try{r=(new URL(".",p)).href}catch{}u=b=>{var d=new XMLHttpRequest;d.open("GET",b,!1);d.responseType="arraybuffer";d.send(null);return new Uint8Array(d.response)};
t=async b=>{b=await fetch(b,{credentials:"same-origin"});if(b.ok)return b.arrayBuffer();throw Error(b.status+" : "+b.url);};var v=console.error.bind(console),w=!1,m,n;function x(){var b=y.buffer;new Int8Array(b);new Int16Array(b);m=new Uint8Array(b);new Uint16Array(b);new Int32Array(b);n=new Uint32Array(b);new Float32Array(b);new Float64Array(b);new BigInt64Array(b);new BigUint64Array(b)}
function z(b){b="Aborted("+b+")";v(b);w=!0;throw new WebAssembly.RuntimeError(b+". Build with -sASSERTIONS for more info.");}var C;async function D(b){try{var d=await t(b);return new Uint8Array(d)}catch{}if(u)b=u(b);else throw"both async and sync fetching of the wasm failed";return b}async function E(b,d){try{var g=await D(b);return await WebAssembly.instantiate(g,d)}catch(e){v(`failed to asynchronously prepare wasm: ${e}`),z(e)}}
async function F(b){var d=C;try{var g=fetch(d,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(g,b)}catch(e){v(`wasm streaming compile failed: ${e}`),v("falling back to ArrayBuffer instantiation")}return E(d,b)}class G{name="ExitStatus";constructor(b){this.message=`Program terminated with exit(${b})`;this.status=b}}
var H=0,I=null,J={},L=b=>{if(!w)try{b()}catch(d){if(!(d instanceof G||"unwind"==d))throw d;}},M,y,N={e:()=>z(""),b:()=>{},c:(b,d)=>{J[b]&&(clearTimeout(J[b].id),delete J[b]);if(!d)return 0;var g=setTimeout(()=>{delete J[b];L(()=>M(b,performance.now()))},d);J[b]={id:g,R:d};return 0},d:b=>{var d=m.length;b>>>=0;if(2147483648<b)return!1;for(var g=1;4>=g;g*=2){a:{var e=(Math.min(2147483648,65536*Math.ceil(Math.max(b,d+50331648/g)/65536))-y.buffer.byteLength+65535)/65536|0;try{y.grow(e);x();var h=1;break a}catch(B){}h=
void 0}if(h)return!0}return!1},a:b=>{throw new G(b);}};function O(){0<H?I=O:0<H?I=O:(c.calledRun=!0,w||(P.g(),c.onRuntimeInitialized?.()))}var P;
(async function(){H++;var b={a:N};C??=r+"usytrace.wasm";b=P=(await F(b)).instance.exports;c._create_buffer=b.h;c._setCurrent=b.i;c._addImage=b.j;c._removeImage=b.k;c._historyStatus=b.l;c._trace=b.m;c._undo=b.n;c._redo=b.o;c._clear=b.p;c._point=b.q;c._autoTrace=b.r;c._eraseRegion=b.s;c._smoothTrace=b.t;c._offsetTrace=b.u;c._exportTrace=b.v;c._snap=b.w;c._getPixelColour=b.x;c._getCurrentPath=b.y;M=b.z;y=b.f;x();H--;0==H&&I&&(b=I,I=null,b());return P})();O();
