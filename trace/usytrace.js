var c;c||=typeof Module != 'undefined' ? Module : {};const l=[];self.onmessage=a=>l.push(a);
c.onRuntimeInitialized=()=>{const a=TextDecoder.prototype.decode.bind(new TextDecoder("utf-8"));var d=b=>(...f)=>{f=b(...f);return a(new Uint8Array(m.buffer,n[f/4],n[f/4+1]))};const g=new Map,e={D:c._create_buffer,N:b=>c._setCurrent(g.get(b)),B:(b,f,k,q)=>g.set(b,c._addImage(f,k,q)),M:b=>{c._removeImage(g.get(b));g.delete(b)},I:c._historyStatus,P:d(c._trace),offsetTrace:d(c._offsetTrace),K:d(c._point),R:d(c._undo),L:d(c._redo),G:d(c._eraseRegion),smooth:d(c._smoothTrace),clear:c._clear,C:d(c._autoTrace),
H:d(c._exportTrace),O:c._snap,J:c._getPixelColour,F:d(c._getCurrentPath)},h=(b,f)=>{b.svg=f;return b},B={setCurrent:({src:b})=>e.N(b),removeImage:({src:b})=>e.M(b),setData:({src:b,type:f,width:k,height:q,data:L})=>{const A=e.D(parseInt(k,10),parseInt(q,10));m.set(L,A);e.B(b,A,parseInt(k,10),parseInt(q,10));return{src:b,type:f}},getHistoryStatus:b=>{const f=e.I();b.undo=!!((f&2)>>1);b.redo=!!(f&1);return b},clearTrace:b=>h(b,e.clear()),undoTrace:b=>h(b,e.R()),redoTrace:b=>h(b,e.L()),eraseRegion:b=>
h(b,e.G(parseInt(b.begin,10),parseInt(b.end,10))),smoothTrace:b=>h(b,e.smooth()),exportTrace:b=>{b["export"]=e.H(parseInt(b.PPO,10),"tab"===b.delim?1:0,parseFloat(b.lowFR),parseFloat(b.highFR),parseFloat(b.SPL.top),parseFloat(b.SPL.topPixel),parseFloat(b.SPL.bottom),parseFloat(b.SPL.bottomPixel),parseFloat(b.FR.top),parseFloat(b.FR.topPixel),parseFloat(b.FR.bottom),parseFloat(b.FR.bottomPixel));return b},addPoint:b=>h(b,e.K(parseInt(b.x,10),parseInt(b.y,10))),autoTrace:b=>h(b,e.C(parseInt(b.colourTolerance,
10))),trace:b=>h(b,e.P(parseInt(b.x,10),parseInt(b.y,10),parseInt(b.colourTolerance,10))),offsetTrace:b=>h(b,e.offsetTrace(parseInt(b.direction,10),parseInt(b.magnitude,10))),snapLine:b=>{b.line.position=e.O(parseInt(b.line.position,10),"x"===b.line.direction?1:0,parseInt(b.direction,10));return b},getPixelColour:b=>{const f=e.J(parseInt(b.x,10),parseInt(b.y,10));b.pixelColour=`${f>>16}, ${f>>8&255}, ${f&255}`;return b},getCurrentPath:b=>h(b,e.F())};d=({data:b})=>{let f;try{f=B[b.type](b)}catch(k){console.error(k.message),
f={type:"error",message:"Out of memory, please refresh the site. (You must have loaded a LOT of images at once)"}}f&&postMessage(f)};self.onmessage=d;for(const b of l)d(b);l.length=0};var p;p=self.location.href;var r="",t,u;try{r=(new URL(".",p)).href}catch{}u=a=>{var d=new XMLHttpRequest;d.open("GET",a,!1);d.responseType="arraybuffer";d.send(null);return new Uint8Array(d.response)};
t=async a=>{a=await fetch(a,{credentials:"same-origin"});if(a.ok)return a.arrayBuffer();throw Error(a.status+" : "+a.url);};var v=console.error.bind(console),w=!1,m,n,x;function y(){var a=z.buffer;new Int8Array(a);new Int16Array(a);m=new Uint8Array(a);new Uint16Array(a);new Int32Array(a);n=new Uint32Array(a);new Float32Array(a);new Float64Array(a);x=new BigInt64Array(a);new BigUint64Array(a)}
function C(a){a="Aborted("+a+")";v(a);w=!0;throw new WebAssembly.RuntimeError(a+". Build with -sASSERTIONS for more info.");}var D;async function E(a){try{var d=await t(a);return new Uint8Array(d)}catch{}if(u)a=u(a);else throw"both async and sync fetching of the wasm failed";return a}async function F(a,d){try{var g=await E(a);return await WebAssembly.instantiate(g,d)}catch(e){v(`failed to asynchronously prepare wasm: ${e}`),C(e)}}
async function G(a){var d=D;try{var g=fetch(d,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(g,a)}catch(e){v(`wasm streaming compile failed: ${e}`),v("falling back to ArrayBuffer instantiation")}return F(d,a)}class H{name="ExitStatus";constructor(a){this.message=`Program terminated with exit(${a})`;this.status=a}}
var I=0,J=null,K={},M=a=>{if(!w)try{a()}catch(d){if(!(d instanceof H||"unwind"==d))throw d;}},N,z,O={f:()=>C(""),b:()=>{},c:(a,d)=>{K[a]&&(clearTimeout(K[a].id),delete K[a]);if(!d)return 0;var g=setTimeout(()=>{delete K[a];M(()=>N(a,performance.now()))},d);K[a]={id:g,S:d};return 0},e:function(a,d,g){if(!(0<=a&&3>=a))return 28;x[g>>3]=BigInt(Math.round(1E6*(0===a?Date.now():performance.now())));return 0},d:a=>{var d=m.length;a>>>=0;if(2147483648<a)return!1;for(var g=1;4>=g;g*=2){a:{var e=(Math.min(2147483648,
65536*Math.ceil(Math.max(a,d+50331648/g)/65536))-z.buffer.byteLength+65535)/65536|0;try{z.grow(e);y();var h=1;break a}catch(B){}h=void 0}if(h)return!0}return!1},a:a=>{throw new H(a);}};function P(){0<I?J=P:0<I?J=P:(c.calledRun=!0,w||(Q.h(),c.onRuntimeInitialized?.()))}var Q;
(async function(){I++;var a={a:O};D??=r+"usytrace.wasm";a=Q=(await G(a)).instance.exports;c._create_buffer=a.i;c._setCurrent=a.j;c._addImage=a.k;c._removeImage=a.l;c._historyStatus=a.m;c._trace=a.n;c._undo=a.o;c._redo=a.p;c._clear=a.q;c._point=a.r;c._autoTrace=a.s;c._eraseRegion=a.t;c._smoothTrace=a.u;c._offsetTrace=a.v;c._exportTrace=a.w;c._snap=a.x;c._getPixelColour=a.y;c._getCurrentPath=a.z;N=a.A;z=a.g;y();I--;0==I&&J&&(a=J,J=null,a());return Q})();P();
